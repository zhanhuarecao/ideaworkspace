<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="zk.test.mapper.EmployeeMapper">

    <!--使用redis作为myBatis的二级缓存-->
    <!--<cache type="org.mybatis.caches.redis.RedisCache" />-->

    <!--连表延迟查询-->
    <resultMap id="getAllEmpAndDept" type="zk.test.entities.Employee">
        <id column="id" property="id"/>
        <result column="last_name" property="lastName"/>
        <result column="gender" property="gender"/>
        <result column="email" property="email"/>
        <association property="department" select="zk.test.mapper.DepartmentMapper.getAllDept"
                     column="d_id"></association>
    </resultMap>
    <select id="getAllEmp" resultMap="getAllEmpAndDept">
      SELECT * FROM tb1_employee WHERE id = #{id}
    </select>


    <!--连表查询-->
    <!--   id  lastName  gender  email           d_id      id  departmentName-->
    <!--column值对应的是从数据库中查出的列名，property是要封装到JavaBean中JavaBean对应的属性-->
    <resultMap id="getAll" type="zk.test.entities.Employee">
        <id column="id" property="id"></id>
        <result column="lastName" property="lastName"></result>
        <result column="gender" property="gender"></result>
        <result column="email" property="email"></result>
        <!--是department这个里面的id、departmentName-->
       <!-- <result column="did" property="department.id"></result>
        <result column="departmentName" property="department.departmentName"></result>-->
        <association property="department" javaType="zk.test.entities.Department">
            <id column="did" property="id"/>
            <result column="departmentName" property="departmentName"/>
        </association>
    </resultMap>

    <select id="getEmpAndDep" resultMap="getAll">
        select e.id,e.last_name lastName ,e.gender, e.email ,d.id did,d.dept_name departmentName
          from tb1_employee e , tb1_dept d where e.d_id = d.id
    </select>

    <select id="getEmps" resultType="zk.test.entities.Employee">
        SELECT id,last_name lastName,gender,email FROM tb1_employee
    </select>


    <insert id="insertEmp" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO tb1_employee (last_name,gender,email,d_id) VALUES (#{lastName},#{gender},#{email},#{department.id})
    </insert>
</mapper>